# Interspect

åŸºäº NestJS 11.x æ„å»ºçš„ API åè®®åˆ†æå·¥å…·ï¼Œé€šè¿‡ HTTP ä»£ç†æœåŠ¡ã€WebSocket ä»£ç†æœåŠ¡ï¼Œæˆªå–äº¤äº’æ•°æ®ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”€ **æ™ºèƒ½ä»£ç†æœåŠ¡** - é«˜æ€§èƒ½ HTTP/HTTPS ä»£ç†
- ğŸ“¡ **WebSocket ç½‘å…³** - åŒå‘æ¶ˆæ¯ä»£ç†å’Œå¹¿æ’­åŠŸèƒ½
- ğŸ“Š **å®æ—¶ç›‘æ§** - è¯·æ±‚/å“åº”æ—¥å¿—è®°å½•ï¼Œæ€§èƒ½æŒ‡æ ‡æ”¶é›†
- ğŸ“± **ä»ªè¡¨ç›˜ç•Œé¢** - åŸºäº Web çš„å®æ—¶ç›‘æ§ä»ªè¡¨ç›˜

## æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: NestJS 11.x
- **è¯­è¨€**: TypeScript 5.x
- **è¿è¡Œæ—¶**: Node.js
- **æµ‹è¯•**: Jest
- **ä»£ç è§„èŒƒ**: ESLint + Prettier
- **WebSocket**: ws

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
npm install
```

### å¼€å‘ç¯å¢ƒå¯åŠ¨

```bash
# å¸¦æ–‡ä»¶ç›‘å¬çš„å¼€å‘æ¨¡å¼
npm run start:dev

# å¸¦è°ƒè¯•æ¨¡å¼çš„å¼€å‘ç¯å¢ƒ
npm run start:debug
```

### ç”Ÿäº§æ„å»ºå’Œè¿è¡Œ

```bash
# æ„å»ºé¡¹ç›®
npm run build

# ç”Ÿäº§ç¯å¢ƒè¿è¡Œ
npm run start:prod
```

## é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ app-config-module/     # é…ç½®ç®¡ç†æ¨¡å—
â”œâ”€â”€ proxy-module/         # ä»£ç†æœåŠ¡æ ¸å¿ƒ
â”‚   â”œâ”€â”€ controllers/      # æ§åˆ¶å™¨
â”‚   â””â”€â”€ services/         # ä»£ç†æœåŠ¡å®ç°
â”œâ”€â”€ inspect-module/       # è¯·æ±‚ç›‘æ§æ¨¡å—
â”‚   â”œâ”€â”€ controllers/      # ç›‘æ§æ§åˆ¶å™¨
â”‚   â””â”€â”€ services/         # æ—¥å¿—å’Œ SSE æœåŠ¡
â”œâ”€â”€ websocket-module/     # WebSocket ç½‘å…³
â”‚   â””â”€â”€ services/         # WebSocket ç½‘å…³æœåŠ¡
â””â”€â”€ common/              # å…¬å…±æ¨¡å—
    â”œâ”€â”€ filters/         # å¼‚å¸¸è¿‡æ»¤å™¨
    â”œâ”€â”€ types/           # ç±»å‹å®šä¹‰
    â””â”€â”€ utils/           # å·¥å…·ç±»
```

## æ ¸å¿ƒæ¨¡å—

### ä»£ç†æœåŠ¡ (Proxy Module)

- **AbstractStaticService**: æŠ½è±¡åŸºç±»ï¼Œæä¾›é€šç”¨çš„ä»£ç†åŠŸèƒ½
- **StaticService**: é™æ€ä»£ç†å®ç°ï¼Œç›´æ¥è½¬å‘è¯·æ±‚
- **è¿æ¥æ± ç®¡ç†**: æ¯ä¸ªä»£ç†æœåŠ¡ä½¿ç”¨ç‹¬ç«‹çš„ HTTP/HTTPS Agent
- **æ€§èƒ½æŒ‡æ ‡**: å®æ—¶æ”¶é›†è¯·æ±‚ç»Ÿè®¡å’Œè¿æ¥æ± æŒ‡æ ‡

### ç›‘æ§æœåŠ¡ (Inspect Module)

- **è¯·æ±‚æ—¥å¿—**: å®Œæ•´è®°å½•è¯·æ±‚å’Œå“åº”å†…å®¹
- **SSE æœåŠ¡**: å®æ—¶æ¨é€ç›‘æ§æ•°æ®åˆ°å‰ç«¯
- **é”™è¯¯è¿½è¸ª**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’ŒæŠ¥å‘Šæœºåˆ¶

### WebSocket ç½‘å…³ (WebSocket Module)

- **åŒå‘ä»£ç†**: å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ¶ˆæ¯åŒå‘è½¬å‘
- **è¿æ¥ç®¡ç†**: è‡ªåŠ¨é‡è¿å’Œä¼˜é›…å…³é—­
- **æ¶ˆæ¯å¹¿æ’­**: æ”¯æŒæ¶ˆæ¯å¹¿æ’­å’Œç»Ÿè®¡

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

```bash
TARGET_SERVER_URL=http://localhost:3000  # ç›®æ ‡æœåŠ¡å™¨ URL
PORT=3000                               # æœåŠ¡ç«¯å£
```

### ä»£ç†é…ç½®

ä»£ç†æœåŠ¡æ”¯æŒä»¥ä¸‹é…ç½®ï¼š
- è¶…æ—¶æ—¶é—´: 120 ç§’
- æœ€å¤§è¿æ¥æ•°: Infinity
- æœ€å¤§ç©ºé—²è¿æ¥: 0
- ç¦ç”¨è¿æ¥å¤ç”¨ (é¿å… socket hang up)

## API æ–‡æ¡£

### ä»£ç†ç«¯ç‚¹

æ‰€æœ‰ HTTP è¯·æ±‚éƒ½ä¼šè¢«ä»£ç†åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼š

```
GET /api/*     -> ä»£ç†åˆ°ç›®æ ‡æœåŠ¡å™¨
POST /api/*    -> ä»£ç†åˆ°ç›®æ ‡æœåŠ¡å™¨
PUT /api/*     -> ä»£ç†åˆ°ç›®æ ‡æœåŠ¡å™¨
DELETE /api/*  -> ä»£ç†åˆ°ç›®æ ‡æœåŠ¡å™¨
```

### ç›‘æ§ç«¯ç‚¹

```bash
GET  /metrics          # è·å–æ€§èƒ½æŒ‡æ ‡
GET  /inspect/sse      # SSE å®æ—¶ç›‘æ§æµ
GET  /inspect/logs     # è·å–è¯·æ±‚æ—¥å¿—
```

### WebSocket è¿æ¥

```bash
ws://localhost:3000/ws  # WebSocket ç½‘å…³è¿æ¥
```

## å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

```bash
# ESLint æ£€æŸ¥å¹¶ä¿®å¤
npm run lint

# Prettier æ ¼å¼åŒ–
npm run format
```

### æµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# ç›‘å¬æ¨¡å¼
npm run test:watch

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:cov

# E2E æµ‹è¯•
npm run test:e2e
```

## ç›‘æ§ä»ªè¡¨ç›˜

è®¿é—® `http://localhost:3000/fusion` æŸ¥çœ‹å®æ—¶ç›‘æ§ä»ªè¡¨ç›˜ï¼ŒåŒ…æ‹¬ï¼š

- è¯·æ±‚ç»Ÿè®¡å’Œæ€§èƒ½æŒ‡æ ‡
- å®æ—¶æ—¥å¿—æµ
- WebSocket è¿æ¥çŠ¶æ€
- ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

## æ„å»ºå’Œéƒ¨ç½²

### æ„å»ºæµç¨‹

1. ç¼–è¯‘ TypeScript ä»£ç 
2. æ³¨å…¥ç‰ˆæœ¬ä¿¡æ¯
3. å¤åˆ¶é™æ€èµ„æº
4. è¾“å‡ºåˆ° `dist/` ç›®å½•

### Docker éƒ¨ç½²

```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

EXPOSE 3000

CMD ["npm", "run", "start:prod"]
```

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ– Pull Requestã€‚